<div class="sigma-page">
  <app-visualization-header class="sigma-header"></app-visualization-header>

  <div class="sigma-container">
    <div class="sigma-main-layout">
      <app-control-panel
        [uploadedFile]="uploadedFile"
        [hoveredCell]="hoveredCell"
        [months]="months"
        [classTypes]="classTypes"
        (fileSelected)="onFileSelect($event)"
        (monthFilterChange)="onMonthFilterChange()"
        (classFilterChange)="onClassFilterChange()"
      ></app-control-panel>

      <main class="sigma-main-content">
      <div class="status-bar">
        <span>{{ getStatusMessage() }}</span>
      </div>

      <!-- Month tabs -->
      <div class="tab-container" *ngIf="getSelectedMonths().length > 1">
        <div class="tab" 
             *ngFor="let month of getSelectedMonths()" 
             [class.active]="activeMonth === month.id"
             (click)="setActiveMonth(month.id)">
          <i class="pi pi-calendar"></i> {{ month.label }}
        </div>
      </div>

      <div class="content-wrapper">
        <app-map-grid
          [cells]="getFilteredCells()"
          [classTypes]="classTypes"
          [hoveredCell]="hoveredCell"
          (cellHover)="onCellHover($event)"
          (cellLeave)="onCellLeave()"
          (cellSelect)="onCellClick($event)"
        ></app-map-grid>

        <app-dashboard-panel
          [dashboardTitle]="getDashboardTitle()"
          [statLabel]="getStatLabel()"
          [visibleCellsCount]="getVisibleCellsCount()"
          [totalCells]="20"
          [coverageLabel]="getCoverageLabel()"
          [coveragePercentage]="getCoveragePercentage()"
          [classDistribution]="getClassDistribution()"
          [chartData]="getChartData()"
        ></app-dashboard-panel>
      </div>

      <div class="bottom-toolbar">
        <div class="toolbar-info">
          {{ getToolbarInfo() }}
        </div>
        <div class="toolbar-buttons">
          <button class="btn-secondary" [routerLink]="['/']">Volver al Inicio</button>
          <button class="btn-secondary" (click)="clearFilters()">Limpiar Filtros</button>
          <button class="btn-primary" (click)="downloadReport()">Descargar Informe</button>
        </div>
      </div>
      </main>
    </div>
  </div>

  <!-- Download Modal -->
  <app-download-modal 
    *ngIf="showDownloadModal"
    (close)="onDownloadModalClose()"
    (download)="onDownloadModalSubmit($event)"
  ></app-download-modal>
</div>
