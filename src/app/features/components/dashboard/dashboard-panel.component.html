<div class="dashboard-section">
  <div class="dashboard-card">
    <div class="dashboard-card-title"><i class="pi pi-chart-bar"></i> {{ dashboardTitle }}</div>
    
    <!-- Mostrar área total cuando hay cobertura por píxeles -->
    <div class="card-stat" *ngIf="usePixelCoverage">
      <span class="stat-label">Área total (m²):</span>
      <span class="stat-value large">{{ filteredTotalAreaM2 | number:'1.2-2' }}</span>
    </div>
    
    <!-- Mostrar conteo de celdas cuando NO hay cobertura por píxeles -->
    <div class="card-stat" *ngIf="!usePixelCoverage">
      <span class="stat-label">{{ statLabel }}:</span>
      <span class="stat-value large">{{ visibleSegmentsCount | number }}</span>
    </div>
    
    <!-- Mostrar información de clases cuando hay cobertura por píxeles -->
    <div class="card-stat" *ngIf="usePixelCoverage">
      <span class="stat-label">{{ coverageLabel }}:</span>
      <span class="stat-value">{{ coverageAreaM2 | number:'1.2-2' }} m² ({{ coveragePercentage | number:'1.2-2' }}%)</span>
    </div>

    <div class="card-stat" *ngIf="usePixelCoverage && selectedPeriodo">
      <span class="stat-label">Período:</span>
      <span class="stat-value">{{ selectedPeriodo }}</span>
    </div>

    <div class="card-stat">
      <span class="stat-label">Total de Clases:</span>
      <span class="stat-value">{{ selectedClassesCount }}</span>
    </div>
    
    <!-- Mostrar información de celdas cuando NO hay cobertura por píxeles -->
    <div class="card-stat" *ngIf="!usePixelCoverage">
      <span class="stat-label">Total de celdas:</span>
      <span class="stat-value">{{ totalSegmentsCount | number }}</span>
    </div>

    <div class="card-stat" *ngIf="!usePixelCoverage">
      <span class="stat-label">{{ coverageLabel }}:</span>
      <span class="stat-value">{{ coverageAreaM2 | number:'1.2-2' }} m² ({{ coveragePercentage | number:'1.2-2' }}%)</span>
    </div>
  </div>

  <!-- ===== NUEVA SECCIÓN: COBERTURA POR PÍXELES ===== -->
  <div class="dashboard-card" *ngIf="sceneId || (usePixelCoverage && filteredPixelCoverageData.length > 0)">
    <div class="dashboard-card-title">
      <i class="pi pi-objects-column"></i> Cobertura de Área (m²)
    </div>

    <div *ngIf="isLoadingCoverage" class="loading-state">
      <i class="pi pi-spin pi-spinner"></i> Cargando análisis de área...
    </div>

    <div *ngIf="coverageError" class="error-state">
      <i class="pi pi-exclamation-circle"></i> {{ coverageError }}
    </div>

    <div *ngIf="!isLoadingCoverage && !coverageError && pixelCoverageData.length > 0">
      <div class="coverage-header">
        <span class="header-label">Área total (m²):</span>
        <span class="header-value">{{ filteredTotalAreaM2 | number:'1.2-2' }}</span>
      </div>

      <table class="coverage-table">
        <thead>
          <tr>
            <th>Color</th>
            <th>Clase</th>
            <th>Área (m²)</th>
            <th>Cobertura (%)</th>
            <th>Visualización</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of filteredPixelCoverageData">
            <td class="color-cell">
              <div class="color-box" [style.background-color]="getColorForClass(item.class_name)"></div>
            </td>
            <td>{{ item.class_name }}</td>
            <td class="area-m2">{{ (item.area_m2 || 0) | number:'1.2-2' }}</td>
            <td class="coverage-percentage">{{ ((item.area_m2 || 0) / (filteredTotalAreaM2 || 1) * 100).toFixed(2) }}%</td>
            <td class="coverage-bar">
              <div class="progress-bar-pixel">
                <div
                  class="progress-fill-pixel"
                  [style.width.%]="(item.area_m2 || 0) / (filteredTotalAreaM2 || 1) * 100"
                  [style.background-color]="getColorForClass(item.class_name)"
                ></div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
