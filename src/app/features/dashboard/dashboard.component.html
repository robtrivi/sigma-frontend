<app-page-header
  title="Dashboard"
  subtitle="Resumen general del sistema SIGMA"
  [breadcrumbs]="[{ label: 'Inicio', routerLink: '/' }, { label: 'Dashboard' }]"
/>

@if (loading()) {
  <div class="loading-container">
    <i class="pi pi-spin pi-spinner" style="font-size: 3rem"></i>
    <p>Cargando datos...</p>
  </div>
} @else {
  <!-- Metrics Cards -->
  <div class="metrics-grid">
    @if (metrics(); as m) {
      <app-stat-card
        label="Imágenes Totales"
        [value]="m.totalImages"
        icon="pi pi-images"
        color="primary"
        subtitle="Imágenes en el sistema"
      />
      <app-stat-card
        label="Imágenes Procesadas"
        [value]="m.processedImages"
        icon="pi pi-check-circle"
        color="success"
        subtitle="Segmentación completada"
      />
      <app-stat-card
        label="Área Total"
        [value]="m.totalArea.toLocaleString() + ' m²'"
        icon="pi pi-map"
        color="info"
        subtitle="Área analizada"
      />
      <app-stat-card
        label="Cobertura Verde"
        [value]="m.greenCoverage + '%'"
        icon="pi pi-chart-pie"
        color="success"
        [showTrend]="true"
        [trend]="2.5"
        subtitle="Del área total"
      />
    }
  </div>

  <!-- Charts Section -->
  <div class="charts-grid">
    <!-- Class Distribution Chart -->
    <div class="chart-card card-shadow">
      <div class="chart-header">
        <h3>
          <i class="pi pi-chart-pie"></i>
          Distribución por Clase
        </h3>
        <p class="chart-subtitle">Porcentaje de área por tipo de uso</p>
      </div>
      <div class="chart-content">
        <p-chart 
          type="doughnut" 
          [data]="distributionChartData" 
          [options]="chartOptions"
          [style]="{'height': '300px'}"
        />
      </div>
    </div>

    <!-- Temporal Analysis Chart -->
    <div class="chart-card card-shadow">
      <div class="chart-header">
        <h3>
          <i class="pi pi-chart-line"></i>
          Análisis Temporal
        </h3>
        <p class="chart-subtitle">Evolución del área por mes</p>
      </div>
      <div class="chart-content">
        <p-chart 
          type="line" 
          [data]="temporalChartData" 
          [options]="chartOptions"
          [style]="{'height': '300px'}"
        />
      </div>
    </div>
  </div>

  <!-- Recent Activities -->
  <div class="activities-section card-shadow">
    <div class="section-header">
      <h3>
        <i class="pi pi-history"></i>
        Actividades Recientes
      </h3>
    </div>
    <p-table 
      [value]="recentActivities()" 
      [paginator]="false"
      styleClass="p-datatable-sm"
    >
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 50px"></th>
          <th>Descripción</th>
          <th style="width: 150px">Fecha</th>
          <th style="width: 120px">Estado</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-activity>
        <tr>
          <td>
            <i 
              [class]="getActivityIcon(activity.type)" 
              [style.color]="getActivityColor(activity.type)"
              style="font-size: 1.5rem"
            ></i>
          </td>
          <td>{{ activity.description }}</td>
          <td>{{ activity.date | formatDate: 'time' }}</td>
          <td>
            <p-tag 
              [value]="(activity.status | statusLabel).label"
              [severity]="(activity.status | statusLabel).severity"
            />
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- Distribution Table -->
  <div class="distribution-table card-shadow">
    <div class="section-header">
      <h3>
        <i class="pi pi-list"></i>
        Detalle de Distribución
      </h3>
    </div>
    <p-table 
      [value]="classDistribution()" 
      [paginator]="false"
      styleClass="p-datatable-sm"
    >
      <ng-template pTemplate="header">
        <tr>
          <th>Clase</th>
          <th style="width: 120px">Área (m²)</th>
          <th style="width: 100px">Porcentaje</th>
          <th style="width: 100px">Color</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-item>
        <tr>
          <td><strong>{{ item.className }}</strong></td>
          <td>{{ item.area.toLocaleString() }}</td>
          <td>{{ item.percentage }}%</td>
          <td>
            <div class="color-indicator" [style.background-color]="item.color"></div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
}
