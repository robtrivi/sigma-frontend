<p-toast />

<app-page-header
  title="Segmentación de Imágenes"
  subtitle="Carga y procesa imágenes TIFF para segmentación automática"
  [breadcrumbs]="[{ label: 'Inicio', routerLink: '/' }, { label: 'Segmentación' }]"
/>

<!-- Upload Section -->
<div class="upload-section card-shadow">
  <h3 class="section-title">
    <i class="pi pi-upload"></i>
    Cargar Nueva Imagen
  </h3>
  
  <p-message severity="info" text="Formatos soportados: TIFF, TIF. Tamaño máximo: 100MB" />
  
  <p-fileUpload
    mode="basic"
    name="tiffFile"
    accept=".tif,.tiff,image/tiff"
    [maxFileSize]="104857600"
    [auto]="true"
    chooseLabel="Seleccionar archivo TIFF"
    [customUpload]="true"
    (uploadHandler)="onUpload($event)"
    [disabled]="isProcessing()"
  />
  
  @if (currentUpload(); as upload) {
    <div class="upload-progress">
      <h4>{{ upload.fileName }}</h4>
      <div class="progress-info">
        <span>Estado: <strong>{{ (upload.status | statusLabel).label }}</strong></span>
        @if (upload.captureDate) {
          <span>Fecha de captura: <strong>{{ upload.captureDate | formatDate }}</strong></span>
        }
      </div>
      <p-progressBar [value]="upload.progress" [showValue]="true" />
    </div>
  }
</div>

<!-- Images List -->
<div class="images-section card-shadow">
  <h3 class="section-title">
    <i class="pi pi-images"></i>
    Imágenes Cargadas
  </h3>

  @if (images().length === 0) {
    <div class="empty-state">
      <i class="pi pi-image" style="font-size: 4rem; opacity: 0.3"></i>
      <p>No hay imágenes cargadas</p>
      <small>Carga una imagen TIFF para comenzar</small>
    </div>
  } @else {
    <div class="images-grid">
      @for (image of images(); track image.id) {
        <div class="image-card">
          <div class="image-card-header">
            <i class="pi pi-file" style="font-size: 2rem; color: var(--sigma-primary)"></i>
            <div class="image-info">
              <h4>{{ image.fileName }}</h4>
              <p class="image-meta">
                {{ formatFileSize(image.fileSize) }} • 
                {{ image.uploadDate | formatDate }}
              </p>
            </div>
          </div>
          
          <div class="image-card-body">
            @if (image.captureDate) {
              <div class="info-item">
                <i class="pi pi-calendar"></i>
                <span>Captura: {{ image.captureDate | formatDate }}</span>
              </div>
            }
            <div class="info-item">
              <i class="pi pi-info-circle"></i>
              <span>Estado: <strong>{{ (image.status | statusLabel).label }}</strong></span>
            </div>
            
            @if (image.status === 'processing') {
              <p-progressBar [value]="image.progress" [showValue]="true" styleClass="mb-2" />
            }
          </div>
          
          <div class="image-card-actions">
            @if (image.status === 'completed') {
              <button 
                pButton 
                label="Ver Resultados" 
                icon="pi pi-eye"
                class="p-button-sm p-button-success"
                (click)="viewResults(image.id)">
              </button>
            }
            @if (image.status === 'pending') {
              <button 
                pButton 
                label="Procesar" 
                icon="pi pi-cog"
                class="p-button-sm p-button-warning"
                (click)="processImage(image.id)">
              </button>
            }
            <button 
              pButton 
              icon="pi pi-trash" 
              class="p-button-sm p-button-danger p-button-text"
              (click)="deleteImage(image.id)">
            </button>
          </div>
        </div>
      }
    </div>
  }
</div>
