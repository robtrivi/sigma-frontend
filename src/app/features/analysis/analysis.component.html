<p-toast />

<app-page-header
  title="Análisis y Filtros"
  subtitle="Filtra y compara análisis temporales de áreas verdes"
  [breadcrumbs]="[{ label: 'Inicio', routerLink: '/' }, { label: 'Análisis' }]"
/>

<div class="analysis-layout">
  <!-- Filters Panel -->
  <div class="filters-sidebar">
    <app-filter-panel
      title="Filtros de Análisis"
      [filters]="filterConfigs"
      [collapsible]="false"
      (filtersChange)="onFiltersChange($event)"
    />
  </div>

  <!-- Main Content -->
  <div class="analysis-content">
    <!-- Temporal Comparison Chart -->
    @if (temporalComparison().length > 0) {
      <div class="chart-section card-shadow">
        <h3>
          <i class="pi pi-chart-bar"></i>
          Comparación Temporal
        </h3>
        <div class="chart-container">
          <p-chart 
            type="bar" 
            [data]="chartData" 
            [options]="chartOptions"
            [style]="{'height': '350px'}"
          />
        </div>
      </div>
    }

    <!-- Results Table -->
    <div class="results-section card-shadow">
      <h3>
        <i class="pi pi-list"></i>
        Resultados de Análisis
      </h3>
      <app-data-table
        [data]="results()"
        [columns]="tableColumns"
        [actions]="tableActions"
        [loading]="loading()"
        [paginator]="true"
        [rows]="10"
        [showGlobalFilter]="true"
        [globalFilterFields]="['name', 'date']"
      />
    </div>

    <!-- Distribution Summary -->
    @if (results().length > 0) {
      <div class="distribution-section">
        @for (result of results(); track result.id; let i = $index) {
          @if (i < 3) {
            <div class="distribution-card card-shadow">
              <h4>{{ result.name }}</h4>
              <div class="distribution-stats">
                <div class="stat-item">
                  <span class="stat-label">Fecha:</span>
                  <span class="stat-value">{{ result.date | formatDate }}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Área Total:</span>
                  <span class="stat-value">{{ result.totalArea.toLocaleString() }} m²</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Cobertura Verde:</span>
                  <span class="stat-value success">{{ result.greenCoverage }}%</span>
                </div>
              </div>
              <div class="distribution-chart">
                @for (classData of result.classDistribution; track classData.className) {
                  <div class="class-bar">
                    <div class="class-info">
                      <span class="class-name">{{ classData.className }}</span>
                      <span class="class-percentage">{{ classData.percentage }}%</span>
                    </div>
                    <div class="progress-bar-container">
                      <div 
                        class="progress-bar-fill" 
                        [style.width.%]="classData.percentage"
                        [style.background-color]="classData.color"
                      ></div>
                    </div>
                  </div>
                }
              </div>
            </div>
          }
        }
      </div>
    }
  </div>
</div>
